<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Filtering my phone contacts with AWK | Licencia para Hackear</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" hreflang="es" href="../../../rss.xml">
<link rel="canonical" href="https://licenciaparahackear.github.io/en/posts/filtrando-mis-contactos-del-celular-con-awk/">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Matías Lang">
<link rel="prev" href="../ekoparty-ctf-stegano-writeup/" title="Ekoparty CTF: Stegano Writeup" type="text/html">
<meta property="og:site_name" content="Licencia para Hackear">
<meta property="og:title" content="Filtering my phone contacts with AWK">
<meta property="og:url" content="https://licenciaparahackear.github.io/en/posts/filtrando-mis-contactos-del-celular-con-awk/">
<meta property="og:description" content="A few weeks ago I changed my Android cellphone for a newer one. I needed to
import my old phone's contacts into the new phone. Since I don't use cloud
storage solutions because of privacy reasons, I h">
<meta property="og:image" content="https://licenciaparahackear.github.io/images/og-awk.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-06-26T19:38:49-03:00">
<meta property="article:tag" content="android">
<meta property="article:tag" content="awk">
<meta property="article:tag" content="unix">
<link rel="alternate" hreflang="es" href="../../../posts/filtrando-mis-contactos-del-celular-con-awk/">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="../../">

            <span id="blog-title">Licencia para Hackear</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item"><a href="../../../" rel="alternate" hreflang="es" class="nav-link">Español</a></li>

                    
                    
    
    <li class="nav-item">
    <a href="index.md" id="sourcelink" class="nav-link">Source</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Filtering my phone contacts with AWK</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Matías Lang
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-06-26T19:38:49-03:00" itemprop="datePublished" title="2021-06-26 19:38">2021-06-26 19:38</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/filtrando-mis-contactos-del-celular-con-awk.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.md" class="sourcelink">Source</a></p>

        </div>
        
        <div class="metadata posttranslations translations">
            <h3 class="posttranslations-intro">Also available in:</h3>
                <p><a href="../../../posts/filtrando-mis-contactos-del-celular-con-awk/" rel="alternate" hreflang="es">Español</a></p>
        </div>

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>A few weeks ago I changed my Android cellphone for a newer one. I needed to
import my old phone's contacts into the new phone. Since I don't use cloud
storage solutions because of privacy reasons, I had to import the contacts
manually, using <a href="https://en.wikipedia.org/wiki/VCard">vCard .vcf files</a>.</p>
<p>Some years ago, when I still used Google services on my phone, the Gmail app
decided to create a phone contact for each user I have emailed to. This created
a lot of useless contacts. Contacts for whom I don't even know their phone
number, only their e-mail. Unsurprisingly, this turned out to be quite annoying.
I couldn't easily get rid of these new contacts, so I kept them even though I
knew I wouldn't use them.</p>
<p>Since I was already changing my phone, it was a good occasion to finally delete
all of these useless contacts. To do this, I would need to:</p>
<ul>
<li>Export my old phone contacts into a <a href="https://en.wikipedia.org/wiki/VCard">.vcf file</a>
</li>
<li>Find or create a tool allowing me to programmatically delete the contacts
  without a phone number</li>
<li>Save the output into a new .vcf file, ready for import into my new phone</li>
</ul>
<p>In order to write the tool to filter contacts, I would need to parse a .vcf
file. Normally, I would have used Python to address the problem. I could have
relied on an <a href="https://gitlab.com/victor-engmark/vcard">external library</a> and trust it didn't have any bugs
or vulnerabilities. Or maybe I could create my own .vcf/vCard parsing library,
properly tested and documented. However, both options looked very complicated
for the problem I intended to resolve. There had to be a simpler solution.</p>
<p>A .vcf file has the following format:</p>
<pre class="code literal-block"><span></span><code><span class="n">BEGIN</span><span class="o">:</span><span class="n">VCARD</span>
<span class="n">VERSION</span><span class="o">:</span><span class="mf">2.1</span>
<span class="n">N</span><span class="o">:</span><span class="n">First</span> <span class="n">Name</span><span class="o">;</span><span class="n">Last</span> <span class="n">name</span><span class="o">;;;</span>
<span class="n">FN</span><span class="o">:</span><span class="n">Visible</span> <span class="n">Name</span>
<span class="n">TEL</span><span class="o">;</span><span class="n">CELL</span><span class="o">:</span><span class="mi">123</span><span class="o">-</span><span class="mi">456</span><span class="o">-</span><span class="mi">789</span>
<span class="n">END</span><span class="o">:</span><span class="n">VCARD</span>
<span class="n">BEGIN</span><span class="o">:</span><span class="n">VCARD</span>
<span class="n">VERSION</span><span class="o">:</span><span class="mf">2.1</span>
<span class="n">N</span><span class="o">:</span><span class="n">Other</span><span class="o">;</span><span class="n">Contact</span><span class="o">;;;</span>
<span class="n">FN</span><span class="o">:</span><span class="n">Other</span> <span class="n">contact</span>
<span class="n">EMAIL</span><span class="o">;</span><span class="n">PREF</span><span class="o">:</span><span class="n">user</span><span class="err">@</span><span class="n">gmail</span><span class="o">.</span><span class="na">com</span>
<span class="n">END</span><span class="o">:</span><span class="n">VCARD</span>
</code></pre>

<p>As you can see, the details of each contact are delimited by the lines
<code>BEGIN:VCARD</code> and <code>END:VCARD</code>. The .vcf format doesn't look complicated. It is
just plain text delimited by formatted lines.</p>
<p>Taking into account that .vcf files were simple, and that I only wanted to
filter through my contact list once, I used <a href="https://en.wikipedia.org/wiki/AWK">AWK</a> instead of Python. The
AWK language is relatively small, and you can learn it in a few hours. <a href="https://en.wikipedia.org/wiki/AWK">Its
Wikipedia page</a> looks good enough as an introduction.</p>
<p>I took another look at the problem I wanted to solve, and built the following
AWK program:</p>
<pre class="code literal-block"><span></span><code><span class="c1"># lines will save the lines of the contact being processed into an array.</span>
<span class="c1"># n represents the length of the lines array. It will increment on each</span>
<span class="c1"># iteration.</span>
<span class="p">{</span>
    <span class="nx">lines</span><span class="p">[</span><span class="nx">n</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0</span><span class="p">;</span> <span class="c1"># This is like append in Python</span>
<span class="p">}</span>

<span class="sr">/^TEL;/</span> <span class="p">{</span>
    <span class="c1"># The contact being processed has a phone number, so I want to keep it</span>
    <span class="nx">has_phone_number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="sr">/^END:VCARD/</span> <span class="p">{</span> <span class="c1"># I reached the end of the contact</span>

    <span class="c1"># If the contact had a phone number, keep it (print all the saved lines)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">has_phone_number</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">n</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
            <span class="kr">print</span> <span class="nx">lines</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>

    <span class="c1"># In the next iteration I'll use a different contact. Reset the program's</span>
    <span class="c1"># state.</span>
    <span class="nx">has_phone_number</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># This is like emptying the lines array</span>
<span class="p">}</span>
</code></pre>

<p>I ran the program with <code>awk -f program.awk &lt;unfiltered-contacts.vcf &gt;filtered-contacts.vcf</code>.
This created a new .vcf file that only contained the contacts with a phone
number. It was ready to be imported into my new cellphone.</p>
<p>With just 13 lines of code (discarding comments and blank lines), I made a
program that solved my problem perfectly. I didn't overthink it by installing
external libraries, creating big class hierarchies, nor making complex file
parsers.</p>
<p>It looks like I was way more productive using a 40-year old language than using
Python, my go-to language for most problems. Because AWK is intended to be used
for handling text files and writing throwaway programs, it was the perfect fit
for my problem. Maybe the code wasn't very maintainable, but I don't have
to care about it if I planned to discard the program after it ran
successfully. I needed a quick solution, and AWK succeeded at it.</p>
<p>I hope that with this short blogpost I explained the essence of the AWK
language. It is a fundamental tool for programmers and sysadmins. You can learn
the language in a few hours, and it will definitely be a productivity boost.</p>
<p>Here are a few useful resources I used when learning AWK:</p>
<ul>
<li><a href="https://blog.jpalardy.com/posts/why-learn-awk/">Why Learn AWK</a></li>
<li>AWK quickstart
  <a href="https://jemma.dev/blog/awk-part-1">part 1</a> and
  <a href="https://jemma.dev/blog/awk-part-2">part 2</a>
</li>
<li>
<a href="https://www.youtube.com/watch?v=IfhMUed9RSE">"An AWK love story"</a>, for those
  who enjoy conference talks</li>
</ul>
<p>There also exists <a href="https://www.goodreads.com/book/show/703101.The_AWK_Programming_Language">a book</a> about the language written by their authors. I
can't recommend it since I haven't read it yet. But in case the resources above
make you want to learn more, this book will probably be a great choice.</p>
<p>Greetings!</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/android/" rel="tag">android</a></li>
            <li><a class="tag p-category" href="../../categories/awk/" rel="tag">awk</a></li>
            <li><a class="tag p-category" href="../../categories/unix/" rel="tag">unix</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../ekoparty-ctf-stegano-writeup/" rel="prev" title="Ekoparty CTF: Stegano Writeup">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="licenciaparahackear",
            disqus_url="https://licenciaparahackear.github.io/en/posts/filtrando-mis-contactos-del-celular-con-awk/",
        disqus_title="Filtering my phone contacts with AWK",
        disqus_identifier="cache/posts/filtrando-mis-contactos-del-celular-con-awk.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="licenciaparahackear";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2021         <a href="mailto:pub@matiaslang.me">Matías Lang</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Licencia Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a><br>Esta obra está bajo una <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Licencia Creative Commons Atribución-CompartirIgual 4.0 Internacional</a>.

            
            
        </footer>
</div>
</div>


        <script src="../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script><script data-goatcounter="https://lph.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
