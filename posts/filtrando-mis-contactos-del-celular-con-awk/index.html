<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Filtrando mis contactos del celular con AWK | Licencia para Hackear</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" hreflang="es" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../../en/rss.xml">
<link rel="canonical" href="https://licenciaparahackear.github.io/posts/filtrando-mis-contactos-del-celular-con-awk/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Matías Lang">
<link rel="prev" href="../ekoparty-ctf-stegano-writeup/" title="Ekoparty CTF: Stegano Writeup" type="text/html">
<meta property="og:site_name" content="Licencia para Hackear">
<meta property="og:title" content="Filtrando mis contactos del celular con AWK">
<meta property="og:url" content="https://licenciaparahackear.github.io/posts/filtrando-mis-contactos-del-celular-con-awk/">
<meta property="og:description" content="Hace unas semanas cambié mi celular con Android. Una de las cosas que tuve que
hacer fue importar los contactos del celu viejo al nuevo. Como no uso soluciones
de almacenamiento en la nube por cuestio">
<meta property="og:image" content="https://licenciaparahackear.github.io/images/og-awk.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-06-26T19:38:49-03:00">
<meta property="article:tag" content="android">
<meta property="article:tag" content="awk">
<meta property="article:tag" content="unix">
<link rel="alternate" hreflang="en" href="../../en/posts/filtrando-mis-contactos-del-celular-con-awk/">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="../../">

            <span id="blog-title">Licencia para Hackear</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item"><a href="../../en/" rel="alternate" hreflang="en" class="nav-link">English</a></li>

                    
                    
    
    <li class="nav-item">
    <a href="index.md" id="sourcelink" class="nav-link">Código fuente</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archivo</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Etiquetas</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">Canal RSS</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Filtrando mis contactos del celular con AWK</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Matías Lang
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-06-26T19:38:49-03:00" itemprop="datePublished" title="2021-06-26 19:38">2021-06-26 19:38</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/filtrando-mis-contactos-del-celular-con-awk.html">Comentarios</a>


            
        </p>
<p class="sourceline"><a href="index.md" class="sourcelink">Código fuente</a></p>

        </div>
        
        <div class="metadata posttranslations translations">
            <h3 class="posttranslations-intro">También disponible en:</h3>
                <p><a href="../../en/posts/filtrando-mis-contactos-del-celular-con-awk/" rel="alternate" hreflang="en">English</a></p>
        </div>

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>Hace unas semanas cambié mi celular con Android. Una de las cosas que tuve que
hacer fue importar los contactos del celu viejo al nuevo. Como no uso soluciones
de almacenamiento en la nube por cuestiones de privacidad, la importación la
hice de forma manual, usando ficheros <a href="https://es.wikipedia.org/wiki/VCard">vCard (con extensión .vcf)</a>.</p>
<p>En su momento, cuando todavía usaba Android con los servicios de Google, a la
aplicación de Gmail se le ocurrió crear un contacto para cada usuario con quien
haya intercambiado algún correo electrónico. Esto me creó un montón de contactos
que no aportan nada en mi celular. Contactos a quienes les escribí por única
vez, sin intención de hacerlo nuevamente. De quienes solamente conozco su
dirección de correo electrónico y no su celular. </p>
<p>Como estaba cambiando el celu, me pareció que sería una buena ocasión para
borrar todos estos contactos innecesarios. Para esto necesitaría:</p>
<ul>
<li>Exportar todos mis contactos del celular viejo a un <a href="https://es.wikipedia.org/wiki/VCard">fichero .vcf</a>
</li>
<li>Encontrar o armar una herramienta que borre todos aquellos contactos que no
  tengan número de teléfono</li>
<li>Grabar la salida en un nuevo fichero .vcf, listo para ser importado en el
  celular nuevo</li>
</ul>
<p>Para escribir una herramienta que filtre contactos tendría que ser capaz de
parsear un fichero .vcf. Normalmente hubiese usado Python para resolver el
problema. Podría haber utilizado una <a href="https://gitlab.com/victor-engmark/vcard">librería externa</a> y confiar
en que no tenga bugs ni vulnerabilidades. O podría haber creado mi propia
librería para manejo de .vcf/vCard, propiamente testeada y documentada. Sin
embargo, ambas opciones parecían demasiado complicadas para un programa que
pretendo correr una única vez. Tiene que haber una solución más simple.</p>
<p>Un fichero vcf tiene el siguiente formato:</p>
<pre class="code literal-block"><span></span><code><span class="n">BEGIN</span><span class="o">:</span><span class="n">VCARD</span>
<span class="n">VERSION</span><span class="o">:</span><span class="mf">2.1</span>
<span class="n">N</span><span class="o">:</span><span class="n">Nombre</span><span class="o">;</span><span class="n">Apellido</span><span class="o">;;;</span>
<span class="n">FN</span><span class="o">:</span><span class="n">Nombre</span> <span class="n">Visible</span>
<span class="n">TEL</span><span class="o">;</span><span class="n">CELL</span><span class="o">:</span><span class="mi">123</span><span class="o">-</span><span class="mi">456</span><span class="o">-</span><span class="mi">789</span>
<span class="n">END</span><span class="o">:</span><span class="n">VCARD</span>
<span class="n">BEGIN</span><span class="o">:</span><span class="n">VCARD</span>
<span class="n">VERSION</span><span class="o">:</span><span class="mf">2.1</span>
<span class="n">N</span><span class="o">:</span><span class="n">Otro</span><span class="o">;</span><span class="n">Contacto</span><span class="o">;;;</span>
<span class="n">FN</span><span class="o">:</span><span class="n">Otro</span> <span class="n">contacto</span> <span class="n">de</span> <span class="n">Gmail</span>
<span class="n">EMAIL</span><span class="o">;</span><span class="n">PREF</span><span class="o">:</span><span class="n">usuario</span><span class="err">@</span><span class="n">gmail</span><span class="o">.</span><span class="na">com</span>
<span class="n">END</span><span class="o">:</span><span class="n">VCARD</span>
</code></pre>

<p>Como se ve, los detalles de cada contacto se encuentran entre las líneas
<code>BEGIN:VCARD</code> y <code>END:VCARD</code>. El formato en sí no parece nada complicado, ya que
es texto plano delimitado por líneas.</p>
<p>Teniendo en cuenta de que quería parsear un fichero en un formato simple y
hacerlo una única vez, me decidí por usar <a href="https://es.wikipedia.org/wiki/AWK">AWK</a> en vez del tradicional
Python. El lenguaje AWK es bastante chico y por esto se puede aprender en pocas
horas. Con leer <a href="https://es.wikipedia.org/wiki/AWK">su página en Wikipedia</a> ya se puede entender bastante su
funcionamiento.</p>
<p>Después de repasar un poco, me armé un programa de awk corto pero efectivo:</p>
<pre class="code literal-block"><span></span><code><span class="c1"># lineas va a guardar las líneas del contacto a procesar en un array.</span>
<span class="c1"># n es la longitud del array, que se incrementa en cada iteración.</span>
<span class="p">{</span>
    <span class="nx">lineas</span><span class="p">[</span><span class="nx">n</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="o">$</span><span class="mi">0</span><span class="p">;</span> <span class="c1"># Esto sería similar a un append en Python</span>
<span class="p">}</span>

<span class="sr">/^TEL;/</span> <span class="p">{</span>
    <span class="c1"># el contacto siendo procesado tiene un teléfono, así que quiero que se muestre</span>
    <span class="nx">tiene_telefono</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="sr">/^END:VCARD/</span> <span class="p">{</span> <span class="c1"># llegué al final del contacto, tengo que decidir si mostrarlo o no</span>

    <span class="c1"># si tenía un teléfono, mostrar todas las líneas que tengo guardadas</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">tiene_telefono</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">n</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
            <span class="kr">print</span> <span class="nx">lineas</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>

    <span class="c1"># en la próxima iteración voy a arrancar con nuevo contacto, así que</span>
    <span class="c1"># reinicio el estado del programa.</span>
    <span class="nx">tiene_telefono</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Esto simula varias el array</span>
<span class="p">}</span>
</code></pre>

<p>Después ejecuté el programa corriendo <code>awk -f miprograma.awk
&lt;contactos-sin-filtrar.vcf &gt;contactos-filtrados.vcf</code>. Eso me generó un nuevo
.vcf con los contactos ya filtrados, listo para importar en mi celular.</p>
<p>Con solamente 13 líneas de código (sin contar comentarios ni líneas vacías),
logré armar un programa que solucionó mi problema a la perfección. No me
compliqué instalando librerías externas, creando jerarquías de clases
inentendibles, ni haciendo parsers complejos de algún formato.</p>
<p>Así parece que con un lenguaje con más de 40 años de antigüedad me sentí más
cómodo que con Python, mi lenguaje de preferencia. Esto se debe a que AWK es un
lenuaje especializado en manejo de ficheros de texto y programas de un solo uso.
Quizás el código no sea tan mantenible, pero no me importa si se que no lo voy a
volver a correr. Necesitaba una solución rapida, y AWK cumplió a la perfección.</p>
<p>Espero con este post haber explicado la esencia del lenguaje AWK. Me parece que
es una herramienta fundamental para cualquier persona que se dedique a programar
o administrar sistemas UNIX-style. El lenguaje se puede aprender en pocas horas,
y es capaz de mejorar muchísimo nuestra productividad.</p>
<p>Algunos recursos que me sirvieron para aprender AWK (están en inglés):</p>
<ul>
<li><a href="https://blog.jpalardy.com/posts/why-learn-awk/">Why Learn AWK</a></li>
<li>Guía rapida de AWK,
  <a href="https://jemma.dev/blog/awk-part-1">parte 1</a> y
  <a href="https://jemma.dev/blog/awk-part-2">parte 2</a>
</li>
<li>
<a href="https://www.youtube.com/watch?v=IfhMUed9RSE">"An AWK love story"</a>, charla que
  explica la escencia del lenguaje</li>
</ul>
<p>También existe <a href="https://www.goodreads.com/book/show/703101.The_AWK_Programming_Language">un libro</a> sobre el lenguaje escrito por sus autores. No
lo puedo recomendar porque todavía lo leí, pero en caso de que los recursos
anteriores te dejen con ganas de más, este libro seguro es el siguiente paso.</p>
<p>Saludos!</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/android/" rel="tag">android</a></li>
            <li><a class="tag p-category" href="../../categories/awk/" rel="tag">awk</a></li>
            <li><a class="tag p-category" href="../../categories/unix/" rel="tag">unix</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../ekoparty-ctf-stegano-writeup/" rel="prev" title="Ekoparty CTF: Stegano Writeup">Publicación anterior</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comentarios</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="licenciaparahackear",
            disqus_url="https://licenciaparahackear.github.io/posts/filtrando-mis-contactos-del-celular-con-awk/",
        disqus_title="Filtrando mis contactos del celular con AWK",
        disqus_identifier="cache/posts/filtrando-mis-contactos-del-celular-con-awk.html",
        disqus_config = function () {
            this.language = "es_ES";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="licenciaparahackear";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2021         <a href="mailto:pub@matiaslang.me">Matías Lang</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Licencia Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a><br>Esta obra está bajo una <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Licencia Creative Commons Atribución-CompartirIgual 4.0 Internacional</a>.

            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script><script data-goatcounter="https://lph.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
